function ConvertTree(e,t=!0){var n=[];n.push(e.id),n.push(e.name),n.push(e.dob),n.push(e.dod),n.push(e.description),n.push(e.gender),e.parent?n.push(e.parent.id):n.push(null);var r=[];for(let t=0;t<e.children.length;t++)r.push(ConvertTree(e.children[t]));if(n.push(r),t){var o=[];for(let t=0;t<e.partners.length;t++)o.push(ConvertTree(e.partners[t],!1));n.push(o)}else n.push(e.partners[0].id);return e.partnerParent?n.push(e.partnerParent.id):n.push(null),n}function RestoreTree(e,t=0){var n=new Node("");if(0==t&&(new_tree=new Tree(""),new_tree._root=n),e[0]>current_id&&(current_id=e[0]+1),n.id=e[0],n.name=e[1],n.dob=e[2],n.dod=e[3],n.description=e[4],n.gender=e[5],null==e[6]?n.parent=null:(callback=function(t){t.id===e[6]&&(parent=t)},new_tree.contains(callback,new_tree.traverseBF),parent&&(n.parent=parent)),Number.isInteger(e[8]))callback=function(t){t.id===e[8]&&(parent=t)},new_tree.contains(callback,new_tree.traverseBF),parent&&n.partners.push(parent);else for(let r=0;r<e[8].length;r++)n.partners.push(RestoreTree(e[8][r],t+1));for(let r=0;r<e[7].length;r++)n.children.push(RestoreTree(e[7][r],t+1));return null==e[9]?n.partnerParent=null:(callback=function(t){for(let n=0;n<t.partners.length;n++)t.partners[n].id==e[9]&&(parent=t.partners[n])},new_tree.contains(callback,new_tree.traverseBF),n.partnerParent=parent),0==t?new_tree:n}function addKeyword(){keywords.push(["smDots","#000000",""]),DrawKeyword()}function removeKeyword(e){keywords.splice(e,1),DrawKeyword()}function DrawKeyword(){x=document.getElementById("list"),x.innerHTML="";for(let e=0;e<keywords.length;e++)form=document.createElement("div"),form.setAttributeNS(null,"class","form-group"),close=document.createElement("i"),close.setAttributeNS(null,"class","fa fa-close"),close.setAttributeNS(null,"style","cursor: pointer; color: rgb(181,37,37)"),close.setAttributeNS(null,"onclick","removeKeyword("+e+")"),form.appendChild(close),options=document.createElement("select"),optgroup=document.createElement("optgroup"),optgroup.setAttributeNS(null,"label","pick the pattern"),options.appendChild(optgroup),option=document.createElement("option"),option.setAttributeNS(null,"value","smDots"),option.innerHTML="Small Polka Dots",optgroup.appendChild(option),option=document.createElement("option"),option.setAttributeNS(null,"value","lgDots"),option.innerHTML="Large Polka Dots",optgroup.appendChild(option),option=document.createElement("option"),option.setAttributeNS(null,"value","smLines"),option.innerHTML="Thin Diagonal Lines",optgroup.appendChild(option),option=document.createElement("option"),option.setAttributeNS(null,"value","lgLines"),option.innerHTML="Thick Diagonal Lines",optgroup.appendChild(option),option=document.createElement("option"),option.setAttributeNS(null,"value","inLines"),option.innerHTML="Inverted Diagonal Lines",optgroup.appendChild(option),option=document.createElement("option"),option.setAttributeNS(null,"value","veLines"),option.innerHTML="Vertical Lines",optgroup.appendChild(option),option=document.createElement("option"),option.setAttributeNS(null,"value","1qua"),option.innerHTML="Solid colour 1st Quadrant",optgroup.appendChild(option),option=document.createElement("option"),option.setAttributeNS(null,"value","2qua"),option.innerHTML="Solid colour 2nd Quadrant",optgroup.appendChild(option),option=document.createElement("option"),option.setAttributeNS(null,"value","3qua"),option.innerHTML="Solid colour 3rd Quadrant",optgroup.appendChild(option),option=document.createElement("option"),option.setAttributeNS(null,"value","4qua"),option.innerHTML="Solid colour 4th Quadrant",optgroup.appendChild(option),options.setAttributeNS(null,"onchange","ChangeKeywords()"),options.setAttributeNS(null,"id",e+"options"),options.value=keywords[e][0],form.appendChild(options),color=document.createElement("input"),color.setAttributeNS(null,"type","color"),color.setAttributeNS(null,"onchange","ChangeKeywords()"),color.setAttributeNS(null,"id",e+"color"),color.value=keywords[e][1],form.appendChild(color),keyword=document.createElement("input"),keyword.setAttributeNS(null,"type","text"),keyword.setAttributeNS(null,"placeholder","keyword to look for"),keyword.setAttributeNS(null,"id",e+"keyword"),keyword.setAttributeNS(null,"onchange","ChangeKeywords()"),keyword.value=keywords[e][2],form.appendChild(keyword),x.appendChild(form);DrawTree(tree._root)}function CreatePatterns(){pattern_dict={smDots:[2.857142857142857,[["circle",1.4285714285714286,1.4285714285714286,.2857142857142857],["circle",0,0,.2857142857142857],["circle",0,2.857142857142857,.2857142857142857],["circle",2.857142857142857,0,.2857142857142857],["circle",2.857142857142857,2.857142857142857,.2857142857142857]]],lgDots:[2.857142857142857,[["circle",1.4285714285714286,1.4285714285714286,.5714285714285714],["circle",0,0,.5714285714285714],["circle",0,2.857142857142857,.5714285714285714],["circle",2.857142857142857,0,.5714285714285714],["circle",2.857142857142857,2.857142857142857,.5714285714285714]]],smLines:[2.857142857142857,[["path","M 0.0,2.857142857142857 l 2.857142857142857,-2.857142857142857 M -0.7142857142857143,0.7142857142857143 l 1.4285714285714286,-1.4285714285714286 M 2.142857142857143,3.5714285714285716 l 1.4285714285714286,-1.4285714285714286","0.2857142857142857"]]],lgLines:[2.857142857142857,[["path","M 0.0,2.857142857142857 l 2.857142857142857,-2.857142857142857 M -0.7142857142857143,0.7142857142857143 l 1.4285714285714286,-1.4285714285714286 M 2.142857142857143,3.5714285714285716 l 1.4285714285714286,-1.4285714285714286","0.5714285714285714"]]],inLines:[8.571428571428571,[["path","M 0.0,8.571428571428571 l 8.571428571428571,-8.571428571428571 M -2.142857142857143,2.142857142857143 l 4.285714285714286,-4.285714285714286 M 6.428571428571429,10.714285714285714 l 4.285714285714286,-4.285714285714286","5.714285714285714"]]],"1qua":[20,[["rect","10","0","0"]]],"2qua":[20,[["rect","10","10","0"]]],"3qua":[20,[["rect","10","0","10"]]],"4qua":[20,[["rect","10","10","10"]]],veLines:[2.857142857142857,[["path","M 1.4285714285714286, 0.0 l 0.0, 2.857142857142857","0.14285714285714285"]]]};for(let e=0;e<keywords.length;e++){pattern=getNode("pattern",{id:"base-"+e,width:pattern_dict[keywords[e][0]][0],height:pattern_dict[keywords[e][0]][0]}),pattern.setAttributeNS(null,"patternUnits","userSpaceOnUse");for(let t=0;t<pattern_dict[keywords[e][0]][1].length;t++)"circle"==pattern_dict[keywords[e][0]][1][t][0]&&(x=getNode("circle",{cx:pattern_dict[keywords[e][0]][1][t][1],cy:pattern_dict[keywords[e][0]][1][t][2],r:pattern_dict[keywords[e][0]][1][t][3],fill:keywords[e][1]})),"path"==pattern_dict[keywords[e][0]][1][t][0]&&(x=getNode("path",{d:pattern_dict[keywords[e][0]][1][t][1],"stroke-width":pattern_dict[keywords[e][0]][1][t][2],stroke:keywords[e][1],"shape-rendering":"auto","stroke-linecap":"square"})),"rect"==pattern_dict[keywords[e][0]][1][t][0]&&(x=getNode("rect",{x:pattern_dict[keywords[e][0]][1][t][2],y:pattern_dict[keywords[e][0]][1][t][3],width:pattern_dict[keywords[e][0]][1][t][1],height:pattern_dict[keywords[e][0]][1][t][1],fill:keywords[e][1]})),pattern.appendChild(x);defs.appendChild(pattern)}}function ChangeKeywords(){for(let e=0;e<keywords.length;e++)options=document.getElementById(e+"options"),keywords[e][0]=options.value,color=document.getElementById(e+"color"),keywords[e][1]=color.value,keyword=document.getElementById(e+"keyword"),keywords[e][2]=keyword.value,DrawTree(tree._root)}function CreateNodePatterns(e){CreatePatterns(),pattern=getNode("pattern",{id:"node-"+e.id,width:1,height:1}),pattern.setAttributeNS(null,"patternUnits","objectBoundingBox"),rect=getNode("rect",{x:0,y:0,width:20,height:20,fill:base_colour}),pattern.appendChild(rect);for(let t=0;t<keywords.length;t++)-1!=e.description.indexOf(keywords[t][2])&&(pattern_rect=getNode("rect",{x:0,y:0,width:20,height:20,fill:"url('#base-"+t+"')"}),pattern.appendChild(pattern_rect));defs.appendChild(pattern)}function DrawText(e,t,n,r=!0){var o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttributeNS(null,"x",t),o.setAttributeNS(null,"y",n),o.setAttributeNS(null,"class","svgText"),o.setAttributeNS(null,"font-size",7),o.setAttributeNS(null,"fill",text_colour),o.setAttributeNS(null,"text-anchor","middle");var i=e.split(" "),d="";if(!r){n-=12,(c=document.createElementNS("http://www.w3.org/2000/svg","tspan")).setAttributeNS(null,"x",t),c.setAttributeNS(null,"y",n);var a=document.createTextNode(e);return c.appendChild(a),o.appendChild(c),svg.appendChild(o),o}NUM_LINES=1;for(var l=0;l<i.length;l++){(s=d+i[l]+" ").length>10?(NUM_LINES+=1,d=i[l]+" "):d=s}d="",n-=12*NUM_LINES;for(l=0;l<i.length;l++){var s;if((s=d+i[l]+" ").length>10){var c;(c=document.createElementNS("http://www.w3.org/2000/svg","tspan")).setAttributeNS(null,"x",t),c.setAttributeNS(null,"y",n);a=document.createTextNode(d);c.appendChild(a),o.appendChild(c),d=i[l]+" ",n+=12}else d=s}(c=document.createElementNS("http://www.w3.org/2000/svg","tspan")).setAttributeNS(null,"x",t),c.setAttributeNS(null,"y",n);a=document.createTextNode(d);return c.appendChild(a),o.appendChild(c),svg.appendChild(o),o}function DrawLine(e,t,n,r,o){var i=getNode("line",{x1:e,y1:t,x2:n,y2:r,stroke:base_colour});svg.appendChild(i)}function DrawSquare(e,t,n){var r=getNode("rect",{x:e-10,y:t-10,width:20,height:20,fill:base_colour,onclick:"EditNode("+n+")"});return svg.appendChild(r),r}function DrawCircle(e,t,n){var r=getNode("circle",{cx:e,cy:t,r:10,fill:base_colour,onclick:"EditNode("+n+")"});return svg.appendChild(r),r}function DrawTriangle(e,t,n){var r=getNode("path",{d:`M${e-=10} ${(t-=10)+20} L${e+20} ${t+20} L${e+10} ${t} L${e} ${t+20} Z`,fill:base_colour,onclick:`EditNode(${n})`});return svg.appendChild(r),r}function DrawNode(e,t,n){return e<min_x&&(min_x=e),e>max_x&&(max_x=e),t<min_y&&(min_y=t),t>max_y&&(max_y=t),CreateNodePatterns(n),"male"==n.gender?drawn_node=DrawSquare(e,t,n.id):"female"==n.gender?drawn_node=DrawCircle(e,t,n.id):drawn_node=DrawTriangle(e,t,n.id),document.getElementById("show_names").checked&&(document.getElementById("show_dob").checked?DrawText(n.name,e,t-10):DrawText(n.name,e,t)),document.getElementById("show_dob").checked&&DrawText(n.dob.split("-")[0]+" - "+n.dod.split("-")[0],e,t,!1),selected_id==n.id?drawn_node.setAttribute("fill",second_colour):drawn_node.setAttributeNS(null,"fill","url('#node-"+n.id+"')"),drawn_node}function DrawPartners(e,t,n){for(let r=0;r<n.partners.length;r++)partner_node=DrawNode(e-40*(r+1),t,n.partners[r]),partner_node.setAttribute("onclick","EditPartnerNode("+n.partners[r].id+")"),DrawLine(e-40*r-10,t,e-40*(r+1)+10,t)}function DrawTree(e,t=1,n=500){1==t&&(ClearTree(),defs.innerHTML="",localStorage.savedTree=JSON.stringify(ConvertTree(e)),localStorage.savedKeywords=JSON.stringify(keywords));var r=50*t,o=0,i=0;for(let a=0;a<e.children.length;a++){var d=n+50*(2*(o+(CountLeaves(e.children[a])-1)/2)-CountLeaves(e)+1)/2;null!=e.children[a].partnerParent?(index=e.partners.indexOf(e.children[a].partnerParent),i=n+40-40*(index+1)):i=e.partners.length>0?n+20:n,""!=e.children[a].dob&&e.children[a+1]&&e.children[a].dob==e.children[a+1].dob?e.children[a].partners.length>0?(DrawLine(i,r,i,r+25),DrawLine(i,r+25,d+45,r+25),DrawLine(d+45,r+25,d+20,r+50)):(DrawLine(i,r,i,r+25),DrawLine(i,r+25,d+25,r+25),DrawLine(d+25,r+25,d,r+50)):""!=e.children[a].dob&&e.children[a-1]&&e.children[a].dob==e.children[a-1].dob?e.children[a].partners.length>0?(DrawLine(i,r,i,r+25),DrawLine(i,r+25,d-5,r+25),DrawLine(d-5,r+25,d+20,r+50)):(DrawLine(i,r,i,r+25),DrawLine(i,r+25,d-25,r+25),DrawLine(d-25,r+25,d,r+50)):e.children[a].partners.length>0?(DrawLine(i,r,i,r+25),DrawLine(i,r+25,d+20,r+25),DrawLine(d+20,r+25,d+20,r+50)):(DrawLine(i,r,i,r+25),DrawLine(i,r+25,d,r+25),DrawLine(d,r+25,d,r+40)),DrawTree(e.children[a],t+1,d),o+=CountLeaves(e.children[a])}e.partners.length>0?(DrawNode(n+20,r,e),DrawPartners(n+20,r,e)):(DrawNode(n,r,e),DrawPartners(n,r,e))}keywords=[],localStorage.savedKeywords&&(keywords=JSON.parse(localStorage.savedKeywords),DrawKeyword());var current_id=0;function Node(e){this.id=current_id,current_id+=1,this.name=e,this.dob="",this.dod="",this.description="",this.gender="",this.parent=null,this.children=[],this.partners=[],this.partnerParent=null}function Tree(e){var t=new Node(e);this._root=t}function findIndex(e,t){for(var n,r=0;r<e.length;r++)e[r].id===t&&(n=r);return n}base_colour="#ff00ff",second_colour="#ff0000",text_colour="#000000",dist_between=50,selected_id=-1,min_x=1e5,max_x=0,min_y=1e5,max_y=0,Tree.prototype.traverseBF=function(e){var t=[];for(t.push(this._root),currentTree=t[0],t=t.slice(1);currentTree;){for(var n=0,r=currentTree.children.length;n<r;n++)t.push(currentTree.children[n]);e(currentTree),currentTree=t[0],t=t.slice(1)}},Tree.prototype.remove=function(e,t,n){var r,o=null;if(this.contains((function(e){e.id===t&&(o=e)}),n),!o)throw new Error("Parent does not exist.");if(void 0===(r=findIndex(o.children,e)))throw new Error("Node to remove does not exist.");return o.children.splice(r,1)},Tree.prototype.contains=function(e,t){t.call(this,e)},Tree.prototype.add=function(e,t,n){var r=new Node(e),o=null;if(this.contains((function(e){e.id===t&&(o=e)}),n),!o)throw new Error("Cannot add node to a non-existent parent.");o.children.push(r),r.parent=o};var trees=[];function DrawTrees(){for(let e=0;e<trees.length;e++)DrawTree(trees[e]._root,1)}function getNode(e,t){for(var n in e=document.createElementNS("http://www.w3.org/2000/svg",e),t)e.setAttributeNS(null,n.replace(/[A-Z]/g,(function(e,t,n,r){return"-"+e.toLowerCase()})),t[n]);return e}function removeNode(e,t){"NONE"==t?(current_id=0,tree=new Tree("Father")):tree.remove(e,t,tree.traverseBF),DrawTree(tree._root)}function EditNode(e){if(selected_id==e?selected_id=-1:selected_id=e,sub_button=document.getElementById("submit"),sub_button.setAttribute("onclick","SubmitInfo("+e+")"),add_child=document.getElementById("add-child"),add_child.setAttribute("onclick","tree.add('child', "+e+", tree.traverseBF); DrawTree(tree._root);"),add_partner=document.getElementById("add-partner"),add_partner.setAttribute("onclick","tree.addPartner('Partner', "+e+", tree.traverseBF); DrawTree(tree._root);"),callback=function(t){t.id===e&&(parent=t)},tree.contains(callback,tree.traverseBF),!parent)throw new Error("Cannot Find Node.");info="SubmitInfo("+e+")",name_entry=document.getElementById("name"),name_entry.setAttribute("onchange",info),name_entry.value=parent.name,DOB_entry=document.getElementById("DOB"),DOB_entry.setAttribute("onchange",info),DOB_entry.value=parent.dob,DOD_entry=document.getElementById("DOD"),DOD_entry.setAttribute("onchange",info),DOD_entry.value=parent.dod,gender_entry=document.getElementById("gender"),gender_entry.setAttribute("onchange",info),gender_entry.value=parent.gender,description_entry=document.getElementById("description"),description_entry.setAttribute("onchange",info),description_entry.value=parent.description,parent.parent?(remove=document.getElementById("remove"),remove.setAttribute("onclick","removeNode("+e+", "+parent.parent.id+")")):(remove=document.getElementById("remove"),remove.setAttribute("onclick",`removeNode(${e}, "NONE")`)),DrawTree(tree._root)}function SubmitInfo(e){if(new_name=document.getElementById("name").value,gender=document.getElementById("gender").value,dob=document.getElementById("DOB").value,dod=document.getElementById("DOD").value,description=document.getElementById("description").value,callback=function(t){t.id===e&&(parent=t)},tree.contains(callback,tree.traverseBF),!parent)throw new Error("Cannot find Node.");parent.name=new_name,parent.dob=dob,parent.dod=dod,parent.gender=gender,parent.description=description,DrawTree(tree._root)}tree=new Tree("Father");var svg=getNode("svg",{width:"100%",height:"auto"});defs=getNode("defs"),svg.appendChild(defs);var div=document.getElementById("main_div");function ClearTree(){svg.innerHTML="",svg.appendChild(defs)}function CountLeaves(e){if(e.partners.length>=1&&0==e.children.length)return 2*e.partners.length;if(0==e.children.length)return 1;sum=0;for(let t=0;t<e.children.length;t++)sum+=CountLeaves(e.children[t]);return e.partners.length>sum/2?2*e.partners.length:sum}function EditPartnerNode(e){if(selected_id==e?selected_id=-1:selected_id=e,sub_button=document.getElementById("submit"),sub_button.setAttribute("onclick","SubmitPartnerInfo("+e+")"),add_child=document.getElementById("add-child"),add_child.setAttribute("onclick","AddPartnerChild("+e+")"),callback=function(t){for(let n=0;n<t.partners.length;n++)t.partners[n].id===e&&(parent=t.partners[n])},tree.contains(callback,tree.traverseBF),!parent)throw new Error("Cannot Find Node.");info="SubmitPartnerInfo("+e+")",name_entry=document.getElementById("name"),name_entry.value=parent.name,name_entry.setAttribute("onchange",info),DOB_entry=document.getElementById("DOB"),DOB_entry.value=parent.dob,DOB_entry.setAttribute("onchange",info),DOD_entry=document.getElementById("DOD"),DOD_entry.value=parent.dod,DOD_entry.setAttribute("onchange",info),gender_entry=document.getElementById("gender"),gender_entry.value=parent.gender,gender_entry.setAttribute("onchange",info),description_entry=document.getElementById("description"),description_entry.setAttribute("onchange",info),description_entry.value=parent.description,DrawTree(tree._root),remove=document.getElementById("remove"),remove.setAttribute("onclick","RemovePartner("+e+")")}function SubmitPartnerInfo(e){if(new_name=document.getElementById("name").value,gender=document.getElementById("gender").value,dob=document.getElementById("DOB").value,dod=document.getElementById("DOD").value,description=document.getElementById("description").value,callback=function(t){for(let n=0;n<t.partners.length;n++)t.partners[n].id===e&&(parent=t.partners[n])},tree.contains(callback,tree.traverseBF),!parent)throw new Error("Cannot find Node.");parent.name=new_name,parent.dob=dob,parent.dod=dod,parent.gender=gender,parent.description=description,DrawTree(tree._root)}function AddPartnerChild(e){callback=function(t){for(let n=0;n<t.partners.length;n++)t.partners[n].id===e&&(parent=t.partners[n])},tree.contains(callback,tree.traverseBF),tree.add("child",parent.partners[0].id,tree.traverseBF),new_child=parent.partners[0].children[parent.partners[0].children.length-1],new_child.partnerParent=parent,parent.children.push(new_child),DrawTree(tree._root)}function RemovePartner(e){callback=function(t){for(let n=0;n<t.partners.length;n++)t.partners[n].id===e&&(parent=t.partners,index=n)},tree.contains(callback,tree.traverseBF),parent.splice(index,1),DrawTree(tree._root)}function printTree(){tree_table=TreeTable(tree._root),size=Math.max(max_x-min_x+60,max_y-min_y+50);var e=window.open("","Planned Timetable","left=0,top=0,toolbars=no,scrollbars=yes,status=no,resizable=no"),t=`<style>.svgText{font-family: 'Poppins', sans-serif;} .table-responsive{display: block; width: 100%; overflow-x: auto;} table, th, td {border: 1px solid black;}</style><svg width="100%" viewBox="${min_x-40} ${min_y-40} ${size} ${size}" transform="rotate(90)">${svg.innerHTML}<div style="break-after: page;"></div><br><br><div class="table-responsive">\n        <table class="table" style="width: 100%">\n            <thead>\n                <tr>\n                    <th>Name</th>\n                    <th>Date of Birth</th>\n                    <th>Date of Death</th>\n                    <th>Gender</th>\n                    <th>Parents</th>\n                    <th>Children</th>\n                    <th>Description</th>\n                </tr>\n            </thead>\n            <tbody>\n                ${tree_table}\n            </tbody>\n        </table>\n    </div>`;e.document.writeln(t),e.document.close(),e.focus(),e.print()}function TreeTable(e,t=!1){if(e.children[0])var n=e.children[0].name;else n="";var r="",o="",i="";e.parent&&(o=e.parent.name),e.partnerParent&&(i=e.partnerParent.name),r=i.length>0&&o.length>0?o+", "+i:o;for(let t=1;t<e.children.length;t++)n=n+", "+e.children[t].name;var d=`<tr><td>${e.name}</td><td>${e.dob}</td><td>${e.dod}</td><td>${e.gender}</td><td>${r}</td><td>${n}</td><td>${e.description}</td></tr>`;if(!t){for(let t=0;t<e.partners.length;t++)d+=TreeTable(e.partners[t],!0);for(let t=0;t<e.children.length;t++)d+=TreeTable(e.children[t])}return d}div.appendChild(svg),svg.setAttribute("viewBox","300 -150 500 500"),document.getElementById("main_color").value=base_colour,document.getElementById("second_color").value=second_colour,document.getElementById("text_color").value=text_colour,localStorage.savedTree&&(tree=RestoreTree(JSON.parse(localStorage.savedTree))),DrawTree(tree._root),Tree.prototype.addPartner=function(e,t,n){var r=new Node(e);this.contains((function(e){e.id===t&&(topartner=e)}),n),topartner.partners.push(r),r.partners.push(topartner)};svg=document.querySelector("svg");var islocked=!1;function getPointFromEvent(e){var t={x:0,y:0};return e.targetTouches?(t.x=e.targetTouches[0].clientX,t.y=e.targetTouches[0].clientY):(t.x=e.clientX,t.y=e.clientY),t}window.PointerEvent?(svg.addEventListener("pointerdown",onPointerDown),svg.addEventListener("pointerup",onPointerUp),svg.addEventListener("pointerleave",onPointerUp),svg.addEventListener("pointermove",onPointerMove)):(svg.addEventListener("mousedown",onPointerDown),svg.addEventListener("mouseup",onPointerUp),svg.addEventListener("mouseleave",onPointerUp),svg.addEventListener("mousemove",onPointerMove),svg.addEventListener("touchstart",onPointerDown),svg.addEventListener("touchend",onPointerUp),svg.addEventListener("touchmove",onPointerMove));var isPointerDown=!1,pointerOrigin={x:0,y:0};function onPointerDown(e){isPointerDown=!0;var t=getPointFromEvent(e);pointerOrigin.x=t.x,pointerOrigin.y=t.y}var viewBox={x:300,y:-150,width:500,height:500},orig_width=viewBox.width,newViewBox={x:0,y:0},ratio=viewBox.width/svg.getBoundingClientRect().width;function zoom(e){if(!(viewBox.width-e/100*orig_width<=0)){viewBox.width=viewBox.width-e/100*orig_width,viewBox.height=viewBox.width;var t=`${newViewBox.x} ${newViewBox.y} ${viewBox.width} ${viewBox.height}`;svg.setAttribute("viewBox",t),ratio=viewBox.width/svg.getBoundingClientRect().width}}function resetView(){viewBox.x=480-viewBox.width/2,viewBox.y=30-viewBox.height/2;var e=`${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`;svg.setAttribute("viewBox",e)}function Togglelock(){islocked=!islocked,lock=document.getElementById("lock"),islocked?lock.setAttribute("class","fa fa-lock"):lock.setAttribute("class","fa fa-unlock-alt")}function onPointerMove(e){if(isPointerDown&&!islocked){e.preventDefault();var t=getPointFromEvent(e);newViewBox.x=viewBox.x-(t.x-pointerOrigin.x)*ratio,newViewBox.y=viewBox.y-(t.y-pointerOrigin.y)*ratio;var n=`${newViewBox.x} ${newViewBox.y} ${viewBox.width} ${viewBox.height}`;svg.setAttribute("viewBox",n)}}function onPointerUp(){isPointerDown=!1,viewBox.x=newViewBox.x,viewBox.y=newViewBox.y}window.addEventListener("resize",(function(){ratio=viewBox.width/svg.getBoundingClientRect().width}));